<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 완료</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- Include header -->
<div id="header-placeholder"></div>

<!-- Order Summary Root Element -->
<div id="order-summary-root" class="container my-5"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Load header.html into #header-placeholder
  document.addEventListener("DOMContentLoaded", function() {
    fetch("/common/header.html")
            .then(response => {
              if (!response.ok) {
                throw new Error("헤더를 불러오는 중 오류가 발생했습니다.");
              }
              return response.text();
            })
            .then(data => {
              document.getElementById("header-placeholder").innerHTML = data;
            })
            .catch(error => {
              console.error("헤더를 로드할 수 없습니다:", error);
            });

    // Load order summary data and render
    loadOrderSummary();
  });

  function loadOrderSummary() {
    const orderId = 1; // 임시로 사용한 주문 ID. 실제로는 URL 파라미터에서 가져와야 함
    fetch(`/api/orders/${orderId}`)
            .then((response) => {
              if (!response.ok) {
                throw new Error('주문 정보를 가져오는 중 오류가 발생했습니다.');
              }
              return response.json();
            })
            .then((order) => {
              renderOrderSummary(order);
            })
            .catch((error) => {
              document.getElementById('order-summary-root').innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            });
  }

  function renderOrderSummary(order) {
    const orderSummaryRoot = document.getElementById('order-summary-root');

    if (!order) {
      orderSummaryRoot.innerHTML = "주문 정보를 불러오는 중입니다...";
      return;
    }

    let itemsHtml = '';
    order.items.forEach((item) => {
      itemsHtml += `
        <div class="d-flex align-items-center mb-4">
          <img src="${item.itemImage}" alt="${item.itemName}" style="width: 100px; height: auto; margin-right: 20px;" />
          <div>
            <p class="mb-1"><strong>제품명: </strong>${item.itemName}</p>
            <p class="mb-1"><strong>사이즈(mm): </strong>230</p>
            <p><strong>수량: </strong>${item.orderitemsQuantity}개</p>
          </div>
        </div>
      `;
    });

    orderSummaryRoot.innerHTML = `
      <div class="card">
        <div class="card-header text-center bg-dark text-white">주문 완료</div>
        <div class="card-body">
          <h5 class="card-title">주문상품 정보</h5>
          ${itemsHtml}

          <hr />

          <h5 class="card-title">주문자</h5>
          <p class="mb-1">${order.recipientName}</p>
          <p class="mb-1">${order.recipientContact}</p>
          <p>elice@naver.com</p>

          <hr />

          <h5 class="card-title">배송지</h5>
          <p class="mb-1">${order.recipientName}</p>
          <p class="mb-1">${order.shippingAddress}</p>
          <p>${order.recipientContact}</p>

          <hr />

          <h5 class="card-title">결제 금액</h5>
          <p class="mb-1"><strong>총 상품 금액: </strong>₩${order.ordersTotalPrice}</p>
          <p class="mb-1"><strong>배송비: </strong>₩${order.deliveryFee}</p>
          <p><strong>총 결제 금액: </strong>₩${order.ordersTotalPrice + order.deliveryFee}</p>

          <div class="mt-4 text-center">
            <button class="btn btn-dark" onclick="window.location.href = '/order-history'">주문내역 바로가기</button>
            <button class="btn btn-outline-dark" onclick="window.location.href = '/shop'">쇼핑 계속하기</button>
          </div>
        </div>
      </div>
    `;
  }
</script>
</body>
</html>
