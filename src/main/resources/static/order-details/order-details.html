<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>주문 배송 상세</title>
  <link href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/common/sidebar.css"> <!-- 사이드바 CSS 링크 추가 -->
</head>
<body>

<!-- Include header -->
<div id="header-placeholder"></div>

<!-- Main container -->
<div class="container mt-5">
  <div class="columns">
    <!-- Include sidebar -->
    <div id="sidebar-placeholder" class="column is-one-quarter"></div>

    <!-- Order Summary Root Element -->
    <div id="order-summary-root" class="column"></div>
  </div>
</div>

<script src="/common/sidebar.js"></script> <!-- 사이드바 JS 링크 추가 -->

<script>
  // Load header.html into #header-placeholder
  document.addEventListener("DOMContentLoaded", function() {
    fetch("/common/header.html")
            .then(response => {
              if (!response.ok) {
                throw new Error("헤더를 불러오는 중 오류가 발생했습니다.");
              }
              return response.text();
            })
            .then(data => {
              document.getElementById("header-placeholder").innerHTML = data;
            })
            .catch(error => {
              console.error("헤더를 로드할 수 없습니다:", error);
            });

    // Load sidebar.html into #sidebar-placeholder
    fetch("/common/sidebar.html")
            .then(response => {
              if (!response.ok) {
                throw new Error("사이드바를 불러오는 중 오류가 발생했습니다.");
              }
              return response.text();
            })
            .then(data => {
              document.getElementById("sidebar-placeholder").innerHTML = data;
            })
            .catch(error => {
              console.error("사이드바를 로드할 수 없습니다:", error);
            });

    // Load order summary data and render
    loadOrderSummary();
  });

  function loadOrderSummary() {
    const orderId = 1; // 임시로 사용한 주문 ID. 실제로는 URL 파라미터에서 가져와야 함
    fetch(`/api/orders/${orderId}`)
            .then((response) => {
              if (!response.ok) {
                throw new Error('주문 정보를 가져오는 중 오류가 발생했습니다.');
              }
              return response.json();
            })
            .then((order) => {
              renderOrderSummary(order);
            })
            .catch((error) => {
              document.getElementById('order-summary-root').innerHTML = `<div class="notification is-danger">${error.message}</div>`;
            });
  }

  function renderOrderSummary(order) {
    const orderSummaryRoot = document.getElementById('order-summary-root');

    if (!order) {
      orderSummaryRoot.innerHTML = "주문 정보를 불러오는 중입니다...";
      return;
    }

    let itemsHtml = '';
    order.items.forEach((item) => {
      itemsHtml += `
        <div class="box mb-4">
          <div class="media">
            <figure class="media-left">
              <p class="image is-128x128">
                <img src="${item.itemImage}" alt="${item.itemName}">
              </p>
            </figure>
            <div class="media-content">
              <div class="content">
                <p><strong>제품명: </strong>${item.itemName}</p>
                <p><strong>사이즈(mm): </strong>230</p>
                <p><strong>수량: </strong>${item.orderitemsQuantity}개</p>
              </div>
            </div>
          </div>
        </div>
      `;
    });

    orderSummaryRoot.innerHTML = `
      <div class="box">
        <h2 class="title is-4 has-text-centered">주문 배송 상세</h2>
        <div class="content">
          <h5 class="title is-5">주문상품 정보</h5>
          ${itemsHtml}

          <hr />

          <h5 class="title is-5">주문자</h5>
          <p class="mb-1">${order.recipientName}</p>
          <p class="mb-1">${order.recipientContact}</p>
          <p>elice@naver.com</p>

          <hr />

          <h5 class="title is-5">주문 상태</h5>
          <p><strong>주문 상태: </strong>${order.orderStatus}</p>

          <hr />

          <h5 class="title is-5">배송지</h5>
          <p class="mb-1">${order.recipientName}</p>
          <p class="mb-1">${order.shippingAddress}</p>
          <p>${order.recipientContact}</p>

          ${
            order.orderStatus !== "Shipped"
                    ? `<div class="mt-3">
                  <button class="button is-link is-light" onclick="editShippingAddress()">배송지 수정</button>
                </div>`
                    : ""
    }

          <hr />

          <h5 class="title is-5">결제 금액</h5>
          <p class="mb-1"><strong>총 상품 금액: </strong>₩${order.ordersTotalPrice}</p>
          <p class="mb-1"><strong>배송비: </strong>₩${order.deliveryFee}</p>
          <p><strong>총 결제 금액: </strong>₩${order.ordersTotalPrice + order.deliveryFee}</p>

          <div class="mt-4 has-text-centered">
          </div>
        </div>
      </div>
    `;
  }

  function editShippingAddress() {
    // 배송지 수정 로직 추가
    alert("배송지 수정 기능을 구현하세요.");
  }
</script>
</body>
</html>
